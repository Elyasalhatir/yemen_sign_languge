<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Manual Studio Premium | Ø§Ø³ØªÙˆØ¯ÙŠÙˆ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„ÙŠØ¯ÙˆÙŠ</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="theme.css">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Noto+Kufi+Arabic:wght@400;700&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --glass: rgba(16, 16, 32, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --neon-teal: #00f2ea;
            --neon-pink: #ff0050;
            --bg-dark: #0a0a12;
            --panel-width: 450px;
        }

        body {
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            margin: 0;
            display: flex;
            background: var(--bg-dark);
            color: #fff;
            font-family: 'Outfit', 'Noto Kufi Arabic', sans-serif;
        }

        #app-container {
            display: flex;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            background: var(--bg-primary);
            flex-direction: row-reverse;
            /* Sidebar on Right */
        }

        /* --- STAGE (Left/Main) --- */
        #avatar-stage {
            flex: 1;
            position: relative;
            background: var(--bg-primary);
            /* background: radial-gradient(circle at center, #1a1a2e 0%, #000 100%); */
            display: flex;
            flex-direction: column;
        }

        /* Floating Nav */
        .floating-nav {
            position: absolute;
            top: 20px;
            left: 20px;
            /* right: auto; */
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .premium-btn-back {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .premium-btn-back:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--neon-teal);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 242, 234, 0.2);
        }

        /* --- SIDEBAR (Right) --- */
        #control-panel {
            width: var(--panel-width);
            height: 100%;
            background: var(--glass);
            backdrop-filter: blur(25px);
            border-right: 1px solid var(--glass-border);
            display: flex;
            flex-direction: column;
            padding: 0;
            z-index: 200;
            box-shadow: 20px 0 50px rgba(0, 0, 0, 0.5);
        }

        .panel-header {
            padding: 2rem 1.5rem;
            background: linear-gradient(180deg, rgba(0, 242, 234, 0.05) 0%, transparent 100%);
            border-bottom: 1px solid var(--glass-border);
        }

        .panel-header h1 {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0;
            background: linear-gradient(90deg, #fff, var(--neon-teal));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
        }

        .panel-header p {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            margin: 5px 0 0 0;
            font-family: 'Noto Kufi Arabic', sans-serif;
        }

        .controls-scroll {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            scrollbar-gutter: stable;
        }

        /* Mobile Fix */
        @media (max-width: 1100px) {
            #app-container {
                flex-direction: column !important;
                /* Stack Vertically */
            }

            #avatar-stage {
                order: 1;
                /* Top */
                height: 45vh !important;
                width: 100%;
                position: sticky;
                top: 0;
                z-index: 500;
            }

            #control-panel {
                order: 2;
                /* Bottom */
                width: 100% !important;
                height: auto;
                flex: 1;
                overflow-y: visible;
                /* Let body handle scroll or container */
            }

            .controls-scroll {
                overflow-y: auto;
                height: 55vh;
                /* Scroll within panel area */
            }
        }

        /* Premium Group */
        .control-group {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            margin-bottom: 1rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .control-group:hover {
            border-color: rgba(0, 242, 234, 0.3);
            background: rgba(255, 255, 255, 0.04);
        }

        .group-header {
            padding: 1rem 1.2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
            background: rgba(255, 255, 255, 0.02);
        }

        .group-header span.title {
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 10px;
            color: rgba(255, 255, 255, 0.9);
        }

        .group-header .chevron {
            font-size: 0.8rem;
            opacity: 0.5;
            transition: transform 0.3s ease;
        }

        .control-group.collapsed .group-body {
            display: none;
        }

        .control-group.collapsed .chevron {
            transform: rotate(-90deg);
        }

        .group-body {
            padding: 1.2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Sliders */
        .control-row {
            margin-bottom: 1.5rem;
        }

        .control-row:last-child {
            margin-bottom: 0.5rem;
        }

        .label-box {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.6rem;
        }

        .label-box label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }

        .value-badge {
            font-family: monospace;
            font-size: 0.75rem;
            background: rgba(0, 242, 234, 0.1);
            color: var(--neon-teal);
            padding: 2px 6px;
            border-radius: 4px;
            min-width: 35px;
            text-align: center;
        }

        input[type="range"] {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            appearance: none;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            background: #fff;
            border: 3px solid var(--neon-teal);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 242, 234, 0.5);
            transition: scale 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            scale: 1.2;
        }

        /* Avatar Selection Options */
        #avatar-selector {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            /* Text visible on dark bg */
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        #avatar-selector option {
            background-color: #333;
            /* Dark background for dropdown */
            color: #fff;
            /* White text */
        }

        /* --- TIMELINE (Bottom) --- */
        #timeline-premium {
            position: absolute;
            bottom: 30px;
            left: 30px;
            right: calc(var(--panel-width) + 30px);
            height: 100px;
            background: rgba(10, 10, 20, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            display: flex;
            align-items: center;
            padding: 0 1.5rem;
            gap: 1.5rem;
            z-index: 50;
        }

        .timeline-main {
            flex: 1;
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 10px 0;
            scrollbar-width: none;
        }

        .timeline-main::-webkit-scrollbar {
            display: none;
        }

        .keyframe-node {
            min-width: 45px;
            height: 60px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .keyframe-node span {
            font-size: 0.7rem;
            opacity: 0.5;
            margin-top: 4px;
        }

        .keyframe-node.active {
            background: var(--neon-teal);
            border-color: #fff;
            color: #000;
            box-shadow: 0 0 15px rgba(0, 242, 234, 0.4);
        }

        .keyframe-node.active span {
            opacity: 0.8;
        }

        .timeline-btns {
            display: flex;
            gap: 8px;
        }

        .t-btn {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 1.1rem;
        }

        .t-btn:hover {
            background: rgba(0, 242, 234, 0.1);
            border-color: var(--neon-teal);
            color: var(--neon-teal);
        }

        .t-btn.primary {
            background: var(--neon-teal);
            color: #000;
            border: none;
        }

        .t-btn.danger {
            background: rgba(255, 0, 80, 0.1);
            border-color: var(--neon-pink);
            color: var(--neon-pink);
        }

        .t-btn.danger:hover {
            background: var(--neon-pink);
            color: #fff;
        }

        /* Save Modal / Panel Section */
        .save-section {
            padding: 1.5rem;
            border-top: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.02);
        }

        .premium-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--glass-border);
            padding: 12px 15px;
            border-radius: 10px;
            color: white;
            margin-bottom: 10px;
            font-size: 0.9rem;
            transition: border 0.3s;
        }

        .premium-input:focus {
            border-color: var(--neon-teal);
            outline: none;
        }

        .premium-btn-save {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            background: linear-gradient(90deg, var(--neon-teal), #00d2ff);
            color: #000;
            font-weight: 800;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .premium-btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 242, 234, 0.3);
        }

        /* Mobile Adjustments */
        @media (max-width: 1100px) {
            #app-container {
                flex-direction: column-reverse;
                /* Controls First in DOM, Avatar Second... Wait. Flex-direction reverses visual order. */
                /* HTML: Control Panel (1), Avatar Stage (2) */
                /* column: Control Top, Avatar Bottom */
                /* column-reverse: Avatar Top, Control Bottom */
            }

            #avatar-stage {
                height: 45vh;
                /* Fixed height for sticky avatar */
                flex: none;
                /* Don't grow/shrink */
                width: 100%;
                z-index: 10;
            }

            #control-panel {
                height: 55vh;
                /* Remaining space */
                flex: none;
                width: 100%;
                overflow-y: auto;
            }

            #timeline-premium {
                left: 10px;
                right: 10px;
                bottom: 10px;
                height: 80px;
                padding: 0 1rem;
            }

            .floating-nav {
                top: 10px;
                left: 10px;
            }
        }

        /* Utilities */
        .sync-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0, 242, 234, 0.05);
            padding: 1rem;
            border-radius: 12px;
            border: 1px dotted var(--neon-teal);
            margin-bottom: 1rem;
        }

        /* Preset Buttons */
        .preset-btn {
            width: 48px;
            height: 48px;
            font-size: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .preset-btn:hover {
            background: rgba(0, 242, 234, 0.2);
            border-color: var(--neon-teal);
            transform: scale(1.1);
        }

        .preset-btn:active {
            transform: scale(0.95);
        }
    </style>
</head>

<body class="yemeni-theme">
    <div id="app-container">
        <!-- Sidebar (Right) -->
        <div id="control-panel">
            <!-- Compact Controls Bar (Similar to Translator) -->
            <div class="compact-controls"
                style="display: flex; gap: 10px; padding: 10px; background: var(--bg-glass); border-bottom: 1px solid var(--border-color); align-items: center; flex-wrap: wrap;">
                <!-- Avatar Select -->
                <select id="avatar-selector" onchange="manualManager.setAvatar(this.value)"
                    style="padding: 5px; border-radius: 8px; background: rgba(0,0,0,0.2); color: var(--text-primary); border: 1px solid var(--border-color);">
                    <option value="male.glb">ğŸ‘± Male</option>
                    <option value="female.glb">ğŸ‘© Female</option>
                </select>

                <!-- Mini Global Transforms -->
                <div style="display: flex; gap: 5px; align-items: center;">
                    <span style="font-size: 0.8rem; color: var(--neon-teal);">Scale</span>
                    <input type="range" min="0.5" max="2.5" step="0.1" value="1.7" style="width: 60px;"
                        oninput="updateGlobal('scale', 'y', this.value)">
                </div>
                <div style="display: flex; gap: 5px; align-items: center;">
                    <span style="font-size: 0.8rem; color: var(--neon-teal);">Rot Y</span>
                    <input type="range" min="-180" max="180" step="5" value="0" style="width: 60px;"
                        oninput="updateGlobal('rot', 'y', this.value)">
                </div>
            </div>

            <div class="panel-header">
                <h1 data-ar="Ø§Ø³ØªÙˆØ¯ÙŠÙˆ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„ÙŠØ¯ÙˆÙŠ" data-en="Manual Studio">Manual Studio</h1>
                <p data-ar="Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ÙˆÙ…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø¨Ø´Ø±ÙŠØ©" data-en="Advanced Control & Motion Simulation">Ø§Ù„ØªØ­ÙƒÙ…
                    Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ÙˆÙ…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</p>
            </div>

            <div class="controls-scroll">
                <!-- Standard Joint Controls Start Here -->
                <div class="control-group">
                    <div class="group-header" onclick="this.parentElement.classList.toggle('collapsed')">
                        <span class="title" data-ar="ğŸŒ Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒÙ„ÙŠ" data-en="ğŸŒ Global Transform">ğŸŒ Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒÙ„ÙŠ
                            (Global Transform)</span>
                        <span class="chevron">â–¼</span>
                    </div>
                    <div class="group-body">
                        <div class="control-row">
                            <div class="label-box"><label>Ø§Ù„Ø­Ø¬Ù… (Scale)</label><span class="value-badge">1.7</span>
                            </div>
                            <input type="range" class="global-control" data-type="scale" min="0.5" max="3" step="0.1"
                                value="1.7">
                        </div>
                        <div class="control-row">
                            <div class="label-box"><label>Ø§Ù„Ø¹Ù…Ù‚ (Position Z)</label><span class="value-badge">-1</span>
                            </div>
                            <input type="range" class="global-control" data-type="pos" data-axis="z" min="-5" max="2"
                                step="0.1" value="-1">
                        </div>
                        <div class="control-row">
                            <div class="label-box"><label>Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ (Position Y)</label><span
                                    class="value-badge">-1.1</span>
                            </div>
                            <input type="range" class="global-control" data-type="pos" data-axis="y" min="-3" max="1"
                                step="0.1" value="-1.1">
                        </div>
                        <div class="control-row">
                            <div class="label-box"><label>Ø§Ù„Ø¬Ø§Ù†Ø¨ (Position X)</label><span class="value-badge">0</span>
                            </div>
                            <input type="range" class="global-control" data-type="pos" data-axis="x" min="-2" max="2"
                                step="0.1" value="0">
                        </div>
                        <div class="control-row">
                            <div class="label-box"><label>Ø§Ù„Ø¯ÙˆØ±Ø§Ù† (Rotation Y)</label><span class="value-badge">0</span>
                            </div>
                            <input type="range" class="global-control" data-type="rot" data-axis="y" min="-180"
                                max="180" step="1" value="0">
                        </div>
                    </div>
                </div>

                <!-- CHARACTER SETTINGS -->
                <div class="control-group collapsed">
                    <div class="group-header" onclick="this.parentElement.classList.toggle('collapsed')">
                        <span class="title" data-ar="ğŸ­ Ø§Ù„Ø´Ø®ØµÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª" data-en="ğŸ­ Character & Settings">ğŸ­ Ø§Ù„Ø´Ø®ØµÙŠØ©
                            ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
                        <span class="chevron">â–¼</span>
                    </div>
                    <div class="group-body">
                        <div class="control-row">
                            <label>Ø§Ø®ØªØ± Ø§Ù„Ø´Ø®ØµÙŠØ©</label>
                            <select id="avatar-selector" onchange="changeAvatar(this.value)" class="premium-input">
                                <option value="" disabled selected>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</option>
                            </select>
                        </div>
                        <div class="sync-toggle">
                            <span style="font-size: 0.9rem; font-weight: 600;">ğŸ”— Ø§Ù„ØªØ²Ø§Ù…Ù† (Mirror)</span>
                            <label class="switch">
                                <input type="checkbox" id="mirror-mode"
                                    style="width: 25px; height: 25px; accent-color: var(--neon-teal);">
                            </label>
                        </div>
                    </div>
                </div>



                <!-- SPINE & CORE -->
                <div class="control-group collapsed">
                    <div class="group-header" onclick="this.parentElement.classList.toggle('collapsed')">
                        <span class="title">ğŸ§ Ø§Ù„Ø¬Ø°Ø¹ ÙˆØ§Ù„Ø¸Ù‡Ø± (Spine & Core)</span>
                        <span class="chevron">â–¼</span>
                    </div>
                    <div class="group-body">
                        <div class="control-row">
                            <div class="label-box"><label>Ø§Ù„ØµØ¯Ø± (Chest 3D)</label></div>
                            <div style="display:flex; gap:8px;">
                                <input type="range" class="bone-control" data-bone="Spine2" data-axis="x" min="-1"
                                    max="1" step="0.1" value="0" title="Bend">
                                <input type="range" class="bone-control" data-bone="Spine2" data-axis="y" min="-1"
                                    max="1" step="0.1" value="0" title="Twist">
                                <input type="range" class="bone-control" data-bone="Spine2" data-axis="z" min="-1"
                                    max="1" step="0.1" value="0" title="Roll">
                            </div>
                        </div>
                        <div class="control-row">
                            <div class="label-box"><label>Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙÙ‚Ø±ÙŠ (Spine 3D)</label></div>
                            <div style="display:flex; gap:8px;">
                                <input type="range" class="bone-control" data-bone="Spine" data-axis="x" min="-1"
                                    max="1" step="0.1" value="0" title="Bend">
                                <input type="range" class="bone-control" data-bone="Spine" data-axis="y" min="-1"
                                    max="1" step="0.1" value="0" title="Twist">
                                <input type="range" class="bone-control" data-bone="Spine" data-axis="z" min="-1"
                                    max="1" step="0.1" value="0" title="Roll">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RIGHT UPPER BODY -->
                <div class="control-group">
                    <div class="group-header" onclick="this.parentElement.classList.toggle('collapsed')">
                        <span class="title">ğŸ’ª Ø§Ù„Ø°Ø±Ø§Ø¹ Ø§Ù„Ø£ÙŠÙ…Ù† (Right Arm)</span>
                        <span class="chevron">â–¼</span>
                    </div>
                    <div class="group-body">
                        <!-- Combined Chain Control -->
                        <div class="control-row"
                            style="background: rgba(0,242,234,0.1); padding: 12px; border-radius: 12px; margin-bottom: 20px; border: 1px solid rgba(0,242,234,0.3);">
                            <div class="label-box"><label style="color: var(--neon-teal); font-weight: 700;">ğŸ”— ØªØ­ÙƒÙ…
                                    Ù…Ø¯Ù…Ø¬ (Combined Control)</label></div>
                            <div style="display:flex; flex-direction:column; gap:8px;">
                                <div style="display:flex; justify-content:space-between; align-items:center;">
                                    <label style="font-size:0.8rem;">X (Bend)</label>
                                    <input type="range" style="width:70%"
                                        oninput="manualManager.updateCombined('Right', 'x', this.value)" min="-3.14"
                                        max="3.14" step="0.1" value="0">
                                </div>
                                <div style="display:flex; justify-content:space-between; align-items:center;">
                                    <label style="font-size:0.8rem;">Y (Twist)</label>
                                    <input type="range" style="width:70%"
                                        oninput="manualManager.updateCombined('Right', 'y', this.value)" min="-3.14"
                                        max="3.14" step="0.1" value="0">
                                </div>
                                <div style="display:flex; justify-content:space-between; align-items:center;">
                                    <label style="font-size:0.8rem;">Z (Roll)</label>
                                    <input type="range" style="width:70%"
                                        oninput="manualManager.updateCombined('Right', 'z', this.value)" min="-3.14"
                                        max="3.14" step="0.1" value="0">
                                </div>
                            </div>
                        </div>

                        <!-- Arm + Elbow Combined -->
                        <div class="control-row"
                            style="background: rgba(0,242,234,0.08); padding: 10px; border-radius: 12px; margin-bottom: 10px; border: 1px solid rgba(0,242,234,0.2);">
                            <div class="label-box"><label style="color: var(--neon-teal); font-weight: 600;">ğŸ’ª Ø°Ø±Ø§Ø¹ +
                                    Ù…Ø±ÙÙ‚ (Arm + Elbow)</label></div>
                            <div style="display:flex; flex-direction:column; gap:5px;">
                                <div style="display:flex; align-items:center;"><span style="width:20px">X</span><input
                                        type="range" style="flex:1"
                                        oninput="manualManager.updateArmElbow('Right', 'x', this.value)" min="-3.14"
                                        max="3.14" step="0.1" value="0"></div>
                                <div style="display:flex; align-items:center;"><span style="width:20px">Y</span><input
                                        type="range" style="flex:1"
                                        oninput="manualManager.updateArmElbow('Right', 'y', this.value)" min="-3.14"
                                        max="3.14" step="0.1" value="0"></div>
                                <div style="display:flex; align-items:center;"><span style="width:20px">Z</span><input
                                        type="range" style="flex:1"
                                        oninput="manualManager.updateArmElbow('Right', 'z', this.value)" min="-3.14"
                                        max="3.14" step="0.1" value="0"></div>
                            </div>
                        </div>

                        <!-- Elbow + Wrist Combined -->
                        <div class="control-row"
                            style="background: rgba(0,242,234,0.08); padding: 10px; border-radius: 12px; margin-bottom: 20px; border: 1px solid rgba(0,242,234,0.2);">
                            <div class="label-box"><label style="color: var(--neon-teal); font-weight: 600;">âœ‹ Ù…Ø±ÙÙ‚ +
                                    Ù…Ø¹ØµÙ… (Elbow + Wrist)</label></div>
                            <div style="display:flex; flex-direction:column; gap:5px;">
                                <div style="display:flex; align-items:center;"><span style="width:20px">X</span><input
                                        type="range" style="flex:1"
                                        oninput="manualManager.updateElbowWrist('Right', 'x', this.value)" min="-3.14"
                                        max="3.14" step="0.1" value="0"></div>
                                <div style="display:flex; align-items:center;"><span style="width:20px">Y</span><input
                                        type="range" style="flex:1"
                                        oninput="manualManager.updateElbowWrist('Right', 'y', this.value)" min="-3.14"
                                        max="3.14" step="0.1" value="0"></div>
                                <div style="display:flex; align-items:center;"><span style="width:20px">Z</span><input
                                        type="range" style="flex:1"
                                        oninput="manualManager.updateElbowWrist('Right', 'z', this.value)" min="-3.14"
                                        max="3.14" step="0.1" value="0"></div>
                            </div>
                        </div>

                        <div class="control-row">
                            <div class="label-box"><label>Ø§Ù„ÙƒØªÙ (Shoulder 360Â°)</label></div>
                            <div style="display:flex; gap:8px;">
                                <input type="range" class="bone-control" data-bone="RightArm" data-axis="x" min="-3.14"
                                    max="3.14" step="0.1" value="0" title="X">
                                <input type="range" class="bone-control" data-bone="RightArm" data-axis="y" min="-3.14"
                                    max="3.14" step="0.1" value="0" title="Y">
                                <input type="range" class="bone-control" data-bone="RightArm" data-axis="z" min="-3.14"
                                    max="3.14" step="0.1" value="0" title="Z">
                            </div>
                        </div>
                        <!-- Hand Chain Control -->
                        <div class="control-row"
                            style="background: rgba(0,242,234,0.08); padding: 10px; border-radius: 10px; margin-bottom: 15px;">
                            <div class="label-box"><label style="color: var(--neon-teal);">ğŸ”— Ø³Ù„Ø³Ù„Ø© Ø§Ù„ÙŠØ¯ (Hand
                                    Chain)</label></div>
                            <input type="range" oninput="manualManager.updateHandChain('Right', this.value)" min="-3.14"
                                max="3.14" step="0.1" value="0">
                        </div>
                        <div class="control-row">
                            <div class="label-box"><label>Ø§Ù„Ù…Ø±ÙÙ‚ (Forearm 360Â°)</label></div>
                            <div style="display:flex; gap:8px;">
                                <input type="range" class="bone-control" data-bone="RightForeArm" data-axis="x"
                                    min="-3.14" max="3.14" step="0.1" value="0" title="X">
                                <input type="range" class="bone-control" data-bone="RightForeArm" data-axis="y"
                                    min="-3.14" max="3.14" step="0.1" value="0" title="Y">
                                <input type="range" class="bone-control" data-bone="RightForeArm" data-axis="z"
                                    min="-3.14" max="3.14" step="0.1" value="0" title="Z">
                            </div>
                        </div>
                        <div class="control-row">
                            <div class="label-box"><label>Ø§Ù„Ù…Ø¹ØµÙ… (Wrist 360Â°)</label></div>
                            <div style="display:flex; gap:8px;">
                                <input type="range" class="bone-control" data-bone="RightHand" data-axis="x" min="-3.14"
                                    max="3.14" step="0.1" value="0" title="X">
                                <input type="range" class="bone-control" data-bone="RightHand" data-axis="y" min="-3.14"
                                    max="3.14" step="0.1" value="0" title="Y">
                                <input type="range" class="bone-control" data-bone="RightHand" data-axis="z" min="-3.14"
                                    max="3.14" step="0.1" value="0" title="Z">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RIGHT FINGERS -->
                <div class="control-group collapsed">
                    <div class="group-header" onclick="this.parentElement.classList.toggle('collapsed')">
                        <span class="title">ğŸ–ï¸ Ø£ØµØ§Ø¨Ø¹ Ø§Ù„ÙŠØ¯ Ø§Ù„ÙŠÙ…Ù†Ù‰</span>
                        <span class="chevron">â–¼</span>
                    </div>
                    <div class="group-body">
                        <div class="control-row"
                            style="background: rgba(0,242,234,0.05); padding: 10px; border-radius: 12px;">
                            <div class="label-box"><label style="color: var(--neon-teal);">âœŠ Fist Mastery</label></div>
                            <input type="range" oninput="manualManager.updateFist('Right', this.value)" min="0" max="1"
                                step="0.05" value="0">
                        </div>
                        <div id="right-fingers-ui"></div>
                    </div>
                </div>

                <!-- LEFT UPPER BODY -->
                <div class="control-group collapsed">
                    <div class="group-header" onclick="this.parentElement.classList.toggle('collapsed')">
                        <span class="title">ğŸ’ª Ø§Ù„Ø°Ø±Ø§Ø¹ Ø§Ù„Ø£ÙŠØ³Ø± (Left Arm)</span>
                        <span class="chevron">â–¼</span>
                    </div>
                    <div class="group-body">
                        <!-- Combined Chain Control -->
                        <div class="control-row"
                            style="background: rgba(0,242,234,0.1); padding: 12px; border-radius: 12px; margin-bottom: 20px; border: 1px solid rgba(0,242,234,0.3);">
                            <div class="label-box"><label style="color: var(--neon-teal); font-weight: 700;">ğŸ”— ØªØ­ÙƒÙ…
                                    Ù…Ø¯Ù…Ø¬ (Combined Control)</label></div>
                            <div style="display:flex; flex-direction:column; gap:8px;">
                                <div style="display:flex; justify-content:space-between; align-items:center;">
                                    <label style="font-size:0.8rem;">X (Bend)</label>
                                    <input type="range" style="width:70%"
                                        oninput="manualManager.updateCombined('Left', 'x', this.value)" min="-3.14"
                                        max="3.14" step="0.1" value="0">
                                </div>
                                <div style="display:flex; justify-content:space-between; align-items:center;">
                                    <label style="font-size:0.8rem;">Y (Twist)</label>
                                    <input type="range" style="width:70%"
                                        oninput="manualManager.updateCombined('Left', 'y', this.value)" min="-3.14"
                                        max="3.14" step="0.1" value="0">
                                </div>
                                <div style="display:flex; justify-content:space-between; align-items:center;">
                                    <label style="font-size:0.8rem;">Z (Roll)</label>
                                    <input type="range" style="width:70%"
                                        oninput="manualManager.updateCombined('Left', 'z', this.value)" min="-3.14"
                                        max="3.14" step="0.1" value="0">
                                </div>
                            </div>
                        </div>

                        <!-- Arm + Elbow Combined -->
                        <div class="control-row"
                            style="background: rgba(0,242,234,0.08); padding: 10px; border-radius: 12px; margin-bottom: 10px; border: 1px solid rgba(0,242,234,0.2);">
                            <div class="label-box"><label style="color: var(--neon-teal); font-weight: 600;">ğŸ’ª Ø°Ø±Ø§Ø¹ +
                                    Ù…Ø±ÙÙ‚ (Arm + Elbow)</label></div>
                            <div style="display:flex; flex-direction:column; gap:5px;">
                                <div style="display:flex; align-items:center;"><span style="width:20px">X</span><input
                                        type="range" style="flex:1"
                                        oninput="manualManager.updateArmElbow('Left', 'x', this.value)" min="-3.14"
                                        max="3.14" step="0.1" value="0"></div>
                                <div style="display:flex; align-items:center;"><span style="width:20px">Y</span><input
                                        type="range" style="flex:1"
                                        oninput="manualManager.updateArmElbow('Left', 'y', this.value)" min="-3.14"
                                        max="3.14" step="0.1" value="0"></div>
                                <div style="display:flex; align-items:center;"><span style="width:20px">Z</span><input
                                        type="range" style="flex:1"
                                        oninput="manualManager.updateArmElbow('Left', 'z', this.value)" min="-3.14"
                                        max="3.14" step="0.1" value="0"></div>
                            </div>
                        </div>

                        <!-- Elbow + Wrist Combined -->
                        <div class="control-row"
                            style="background: rgba(0,242,234,0.08); padding: 10px; border-radius: 12px; margin-bottom: 20px; border: 1px solid rgba(0,242,234,0.2);">
                            <div class="label-box"><label style="color: var(--neon-teal); font-weight: 600;">âœ‹ Ù…Ø±ÙÙ‚ +
                                    Ù…Ø¹ØµÙ… (Elbow + Wrist)</label></div>
                            <div style="display:flex; flex-direction:column; gap:5px;">
                                <div style="display:flex; align-items:center;"><span style="width:20px">X</span><input
                                        type="range" style="flex:1"
                                        oninput="manualManager.updateElbowWrist('Left', 'x', this.value)" min="-3.14"
                                        max="3.14" step="0.1" value="0"></div>
                                <div style="display:flex; align-items:center;"><span style="width:20px">Y</span><input
                                        type="range" style="flex:1"
                                        oninput="manualManager.updateElbowWrist('Left', 'y', this.value)" min="-3.14"
                                        max="3.14" step="0.1" value="0"></div>
                                <div style="display:flex; align-items:center;"><span style="width:20px">Z</span><input
                                        type="range" style="flex:1"
                                        oninput="manualManager.updateElbowWrist('Left', 'z', this.value)" min="-3.14"
                                        max="3.14" step="0.1" value="0"></div>
                            </div>
                        </div>

                        <div class="control-row">
                            <div class="label-box"><label>Ø§Ù„ÙƒØªÙ (Shoulder 360Â°)</label></div>
                            <div style="display:flex; gap:8px;">
                                <input type="range" class="bone-control" data-bone="LeftArm" data-axis="x" min="-3.14"
                                    max="3.14" step="0.1" value="0" title="X">
                                <input type="range" class="bone-control" data-bone="LeftArm" data-axis="y" min="-3.14"
                                    max="3.14" step="0.1" value="0" title="Y">
                                <input type="range" class="bone-control" data-bone="LeftArm" data-axis="z" min="-3.14"
                                    max="3.14" step="0.1" value="0" title="Z">
                            </div>
                        </div>
                        <!-- Hand Chain Control -->
                        <div class="control-row"
                            style="background: rgba(0,242,234,0.08); padding: 10px; border-radius: 10px; margin-bottom: 15px;">
                            <div class="label-box"><label style="color: var(--neon-teal);">ğŸ”— Ø³Ù„Ø³Ù„Ø© Ø§Ù„ÙŠØ¯ (Hand
                                    Chain)</label></div>
                            <input type="range" oninput="manualManager.updateHandChain('Left', this.value)" min="-3.14"
                                max="3.14" step="0.1" value="0">
                        </div>
                        <div class="control-row">
                            <div class="label-box"><label>Ø§Ù„Ù…Ø±ÙÙ‚ (Forearm 360Â°)</label></div>
                            <div style="display:flex; gap:8px;">
                                <input type="range" class="bone-control" data-bone="LeftForeArm" data-axis="x"
                                    min="-3.14" max="3.14" step="0.1" value="0" title="X">
                                <input type="range" class="bone-control" data-bone="LeftForeArm" data-axis="y"
                                    min="-3.14" max="3.14" step="0.1" value="0" title="Y">
                                <input type="range" class="bone-control" data-bone="LeftForeArm" data-axis="z"
                                    min="-3.14" max="3.14" step="0.1" value="0" title="Z">
                            </div>
                        </div>
                        <div class="control-row">
                            <div class="label-box"><label>Ø§Ù„Ù…Ø¹ØµÙ… (Wrist 360Â°)</label></div>
                            <div style="display:flex; gap:8px;">
                                <input type="range" class="bone-control" data-bone="LeftHand" data-axis="x" min="-3.14"
                                    max="3.14" step="0.1" value="0" title="X">
                                <input type="range" class="bone-control" data-bone="LeftHand" data-axis="y" min="-3.14"
                                    max="3.14" step="0.1" value="0" title="Y">
                                <input type="range" class="bone-control" data-bone="LeftHand" data-axis="z" min="-3.14"
                                    max="3.14" step="0.1" value="0" title="Z">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LEFT FINGERS -->
                <div class="control-group collapsed">
                    <div class="group-header" onclick="this.parentElement.classList.toggle('collapsed')">
                        <span class="title">ğŸ–ï¸ Ø£ØµØ§Ø¨Ø¹ Ø§Ù„ÙŠØ¯ Ø§Ù„ÙŠØ³Ø±Ù‰</span>
                        <span class="chevron">â–¼</span>
                    </div>
                    <div class="group-body">
                        <div class="control-row"
                            style="background: rgba(0,242,234,0.05); padding: 10px; border-radius: 12px;">
                            <div class="label-box"><label style="color: var(--neon-teal);">âœŠ Fist Mastery</label></div>
                            <input type="range" oninput="manualManager.updateFist('Left', this.value)" min="0" max="1"
                                step="0.05" value="0">
                        </div>
                        <div id="left-fingers-ui"></div>
                    </div>
                </div>

                <!-- HEAD & NECK -->
                <div class="control-group collapsed">
                    <div class="group-header" onclick="this.parentElement.classList.toggle('collapsed')">
                        <span class="title">ğŸ‘¤ Ø§Ù„Ø±Ø£Ø³ ÙˆØ§Ù„Ø±Ù‚Ø¨Ø© (Head & Neck)</span>
                        <span class="chevron">â–¼</span>
                    </div>
                    <div class="group-body">
                        <div class="control-row">
                            <div class="label-box"><label>Ø§Ù„Ø±Ù‚Ø¨Ø© (Neck 3D)</label></div>
                            <div style="display:flex; gap:8px;">
                                <input type="range" class="bone-control" data-bone="Neck" data-axis="x" min="-1" max="1"
                                    step="0.1" value="0" title="Bend">
                                <input type="range" class="bone-control" data-bone="Neck" data-axis="y" min="-1" max="1"
                                    step="0.1" value="0" title="Twist">
                                <input type="range" class="bone-control" data-bone="Neck" data-axis="z" min="-1" max="1"
                                    step="0.1" value="0" title="Roll">
                            </div>
                        </div>
                        <div class="control-row">
                            <div class="label-box"><label>Ø§Ù„Ø±Ø£Ø³ (Head 3D)</label></div>
                            <div style="display:flex; gap:8px;">
                                <input type="range" class="bone-control" data-bone="Head" data-axis="x" min="-1" max="1"
                                    step="0.1" value="0" title="Bend">
                                <input type="range" class="bone-control" data-bone="Head" data-axis="y" min="-1" max="1"
                                    step="0.1" value="0" title="Twist">
                                <input type="range" class="bone-control" data-bone="Head" data-axis="z" min="-1" max="1"
                                    step="0.1" value="0" title="Roll">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="save-section">
                <div style="display: flex; gap: 10px; margin-bottom: 12px;">
                    <button class="t-btn danger" style="width: 100%; height: auto; padding: 12px;"
                        onclick="manualManager.resetAll()">
                        ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· (Reset All)
                    </button>
                    <input type="checkbox" id="mirror-mode" style="display:none;" onchange="/* logic in manager */">
                </div>
                <input type="text" id="anim-name-en" placeholder="Animation Name (English)" class="premium-input">
                <input type="text" id="anim-name-ar" placeholder="Ø§Ø³Ù… Ø§Ù„Ø­Ø±ÙƒØ© (Ø¹Ø±Ø¨ÙŠ)" class="premium-input"
                    style="text-align: right;">
                <button class="premium-btn-save" onclick="saveAnimation()">Save Animation | Ø­ÙØ¸ Ø§Ù„Ø­Ø±ÙƒØ©</button>
            </div>
        </div>

        <!-- Main Stage (Left) -->
        <div id="avatar-stage">
            <div class="floating-nav">
                <a href="welcome.html" class="premium-btn-back"><span>ğŸ </span> Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            </div>

            <a-scene embedded vr-mode-ui="enabled: false" shadow="type: pcfsoft">
                <a-assets>
                    <a-asset-item id="ground-tex" src="https://cdn.aframe.io/a-painter/images/floor.jpg"></a-asset-item>
                </a-assets>

                <!-- Lighting (Synced with Camera Studio) -->
                <a-entity light="type: ambient; color: #BBB; intensity: 0.5"></a-entity>
                <a-entity light="type: directional; color: #FFF; intensity: 0.8; castShadow: true"
                    position="-0.5 1 1"></a-entity>
                <a-entity light="type: point; color: #00f2ea; intensity: 0.5; distance: 10" position="2 2 2"></a-entity>
                <a-entity light="type: point; color: #ff0050; intensity: 0.5; distance: 10"
                    position="-2 2 2"></a-entity>

                <a-sky id="scene-sky" color="#0d0d1a"></a-sky> <!-- Synced Background (Dark Mode) -->

                <script>
                    // Sync 3D Sky with Theme
                    window.addEventListener('themeChanged', (e) => {
                        const sky = document.getElementById('scene-sky');
                        if (sky) {
                            // Light Mode: #f0f2f5 (Matches CSS --bg-primary), Dark Mode: #0d0d1a
                            sky.setAttribute('color', e.detail.theme === 'light' ? '#f0f2f5' : '#0d0d1a');
                        }
                    });

                    // Initial Check (in case loaded late)
                    document.addEventListener('DOMContentLoaded', () => {
                        const currentTheme = localStorage.getItem('theme') || 'dark';
                        const theme = localStorage.getItem('theme') || 'dark';
                        const sky = document.getElementById('recorder-sky');
                        const ground = document.getElementById('recorder-ground');
                        const color = theme === 'light' ? '#cbd5e1' : '#1a1a2e';

                        if (sky) sky.setAttribute('color', color);
                        if (ground) ground.setAttribute('color', color);
                    });
                </script>

                <!-- Ground: Synced with Background -->
                <a-grid id="ground-grid"
                    material="src: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAIklEQVQIW2NkQAKrVq36zwjjgzjwqFHtRxIwNQMmAYSEgwkAMssX/w+uMzAAAAAASUVORK5CYII=); repeat: 50 50"
                    rotation="-90 0 0" width="100" height="100" position="0 -1.01 0">
                </a-grid>
                <a-plane id="recorder-ground" rotation="-90 0 0" width="100" height="100" color="#1a1a2e"
                    position="0 -1.02 0"></a-plane>
                <a-gltf-model position="0 -1.1 -1" src="avatars/male.glb" id="avatar" scale="1.7 1.7 1.7"
                    shadow="receive: true; cast: true"></a-gltf-model>

                <a-entity id="camera" camera look-controls="enabled: false" wasd-controls="enabled: false"
                    position="0 1.25 1.1"></a-entity>
            </a-scene>

            <!-- Premium Timeline -->
            <div id="timeline-premium">
                <div class="timeline-btns">
                    <button class="t-btn primary" onclick="captureFrame()" title="Capture Frame">ğŸ“¸</button>
                    <button class="t-btn danger" onclick="deleteLastFrame()" title="Delete Last">ğŸ”™</button>
                </div>

                <div class="timeline-main" id="keyframe-container">
                    <div style="color: rgba(255,255,255,0.2); font-size: 0.8rem; padding: 10px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ù‚Ø·Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹...
                    </div>
                </div>

                <div class="timeline-btns">
                    <button class="t-btn" id="play-btn" onclick="playAnimation()">â–¶</button>
                    <button class="t-btn danger" onclick="stopAnimation()">â¹</button>
                </div>
            </div>
        </div>
    </div>

    <!-- UI Helpers -->
    <script>
        function generateFingerUI(hand) {
            const fingers = [
                { id: 'Thumb', name: hand === 'Right' ? 'Ø¥Ø¨Ù‡Ø§Ù… (ÙŠÙ…ÙŠÙ†)' : 'Ø¥Ø¨Ù‡Ø§Ù… (ÙŠØ³Ø§Ø±)', icon: 'ğŸ‘' },
                { id: 'Index', name: hand === 'Right' ? 'Ø³Ø¨Ø§Ø¨Ø© (ÙŠÙ…ÙŠÙ†)' : 'Ø³Ø¨Ø§Ø¨Ø© (ÙŠØ³Ø§Ø±)', icon: 'â˜ï¸' },
                { id: 'Middle', name: hand === 'Right' ? 'ÙˆØ³Ø·Ù‰ (ÙŠÙ…ÙŠÙ†)' : 'ÙˆØ³Ø·Ù‰ (ÙŠØ³Ø§Ø±)', icon: 'ğŸ–•' },
                { id: 'Ring', name: hand === 'Right' ? 'Ø¨Ù†ØµØ± (ÙŠÙ…ÙŠÙ†)' : 'Ø¨Ù†ØµØ± (ÙŠØ³Ø§Ø±)', icon: 'ğŸ’' },
                { id: 'Pinky', name: hand === 'Right' ? 'Ø®Ù†ØµØ± (ÙŠÙ…ÙŠÙ†)' : 'Ø®Ù†ØµØ± (ÙŠØ³Ø§Ø±)', icon: 'ğŸ¤™' }
            ];

            return fingers.map(f => `
                <div class="finger-container" style="margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 10px;">
                    <div class="group-header smaller" onclick="this.nextElementSibling.classList.toggle('hidden')" style="cursor:pointer; display:flex; align-items:center; gap:8px; margin-bottom: 5px;">
                        <span style="font-size:1.1rem;">${f.icon}</span>
                        <span style="font-size:0.85rem; font-weight:600; color:#ccc;">${f.name}</span>
                        <span style="font-size:0.7rem; opacity:0.5; margin-right:auto;">Ø§Ù†Ù‚Ø± Ù„Ù„ØªÙØµÙŠÙ„ â–¼</span>
                    </div>
                    <div class="finger-details hidden">
                        <!-- Segment 1 (Knuckle) -->
                        <div class="control-row segment-row">
                            <label>Ø§Ù„Ù…ÙØµÙ„ 1 (Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ)</label>
                            <div style="display:flex; gap:5px;">
                                <input type="range" class="finger-control" data-hand="${hand}" data-finger="${f.id}" data-type="k_x_idx_1" min="-2" max="2" step="0.1" value="0" title="X">
                                <input type="range" class="finger-control" data-hand="${hand}" data-finger="${f.id}" data-type="k_y_idx_1" min="-1.5" max="1.5" step="0.1" value="0" title="Y">
                                <input type="range" class="finger-control" data-hand="${hand}" data-finger="${f.id}" data-type="k_z_idx_1" min="-1.5" max="1.5" step="0.1" value="0" title="Z">
                            </div>
                        </div>
                        <!-- Segment 2 (Middle) -->
                        <div class="control-row segment-row">
                            <label>Ø§Ù„Ù…ÙØµÙ„ 2 (Ø§Ù„Ø£ÙˆØ³Ø·)</label>
                            <div style="display:flex; gap:5px;">
                                <input type="range" class="finger-control" data-hand="${hand}" data-finger="${f.id}" data-type="k_x_idx_2" min="-2" max="2" step="0.1" value="0" title="X">
                                <input type="range" class="finger-control" data-hand="${hand}" data-finger="${f.id}" data-type="k_y_idx_2" min="-1.5" max="1.5" step="0.1" value="0" title="Y">
                                <input type="range" class="finger-control" data-hand="${hand}" data-finger="${f.id}" data-type="k_z_idx_2" min="-1.5" max="1.5" step="0.1" value="0" title="Z">
                            </div>
                        </div>
                        <!-- Segment 3 (Tip) -->
                        <div class="control-row segment-row">
                            <label>Ø§Ù„Ù…ÙØµÙ„ 3 (Ø§Ù„Ø·Ø±ÙÙŠ)</label>
                            <div style="display:flex; gap:5px;">
                                <input type="range" class="finger-control" data-hand="${hand}" data-finger="${f.id}" data-type="k_x_idx_3" min="-2" max="2" step="0.1" value="0" title="X">
                                <input type="range" class="finger-control" data-hand="${hand}" data-finger="${f.id}" data-type="k_y_idx_3" min="-1.5" max="1.5" step="0.1" value="0" title="Y">
                                <input type="range" class="finger-control" data-hand="${hand}" data-finger="${f.id}" data-type="k_z_idx_3" min="-1.5" max="1.5" step="0.1" value="0" title="Z">
                            </div>
                        </div>
                        <div class="control-row" style="margin-top:5px; padding-top:5px; border-top: 1px dotted rgba(255,255,255,0.1);">
                            <div class="label-box"><label>Ø¥ØºÙ„Ø§Ù‚ Ù…Ø¬Ù…Ø¹ (Chain Curl)</label></div>
                            <input type="range" class="finger-control" data-hand="${hand}" data-finger="${f.id}" data-type="curl" min="0" max="1" step="0.05" value="0">
                        </div>
                    </div>
                </div>
            `).join('');
        }
        document.getElementById('right-fingers-ui').innerHTML = generateFingerUI('Right');

        const leftFingersContainer = document.getElementById('left-fingers-ui');
        if (leftFingersContainer) {
            leftFingersContainer.innerHTML = generateFingerUI('Left');
        }

        // Value Badge Updater
        document.addEventListener('input', (e) => {
            if (e.target.type === 'range') {
                const badge = e.target.parentElement.querySelector('.value-badge');
                if (badge) badge.innerText = e.target.value;
            }
        });
    </script>
    <style>
        .hidden {
            display: none !important;
        }

        .segment-row {
            background: rgba(255, 255, 255, 0.02);
            padding: 5px !important;
            border-radius: 8px;
            margin-bottom: 5px;
        }

        .segment-row label {
            font-size: 0.75rem;
            color: #888;
            display: block;
            margin-bottom: 3px;
        }

        .finger-details {
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            margin-top: 5px;
        }
    </style>

    <script type="module" src="./src/ManualAvatarManager.js"></script>
    <script src="src/global-ui.js"></script>
    <script>
        // Global Transform Logic (Compact Bar)
        function updateGlobal(type, axis, value) {
            const avatar = document.getElementById('male');
            if (!avatar) return;

            const val = parseFloat(value);
            if (type === 'scale') {
                avatar.setAttribute('scale', `${val} ${val} ${val}`);
            } else if (type === 'rot') {
                const r = avatar.getAttribute('rotation');
                r[axis] = val;
                avatar.setAttribute('rotation', r);
            }
        }
        window.updateGlobal = updateGlobal;
    </script>
</body>

</html>